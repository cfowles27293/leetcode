import requests
import bs4
from bs4.dammit import EncodingDetector
from urllib.request import Request, urlopen, urlretrieve

def get_flag(url):
    try:
        url = url.replace(" ", "%20")
        useragent = ["Mozilla/5.0 (compatible; Googlebot/2.1; +http://google.com/bot.html)",
                     "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:80.0) Gecko/20100101 Firefox/80.0",
                     "Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:47.0) Gecko/20100101 Firefox/47.0",
                     "Mozilla/5.0 (Macintosh; Intel Mac OS X x.y; rv:42.0) Gecko/20100101 Firefox/42.0"]
        headers = {"User-Agent": useragent[1]}
        req = Request(url)
        a = urlopen(req).read()
        html_encoding = EncodingDetector.find_declared_encoding(a, is_html=True)
        search_soup = bs4.BeautifulSoup(a, from_encoding=html_encoding, features="lxml")
        resp = search_soup.find_all('a')
        for i in resp:
            filename = i.extract().get_text()
            url_new = url+filename
            url_new = url_new.replace(" ", "%20")
            if (filename[-1] == '/' and filename[0] != '.'):
                get_flag(url_new)
                print(url_new)

    except Exception as e:
        print(e)

result = get_flag("https://www.google.com/search?client=firefox-b-d&q=questrade")
print(result)